C51 COMPILER V9.02   SPI_ADCMCP3204                                                        09/29/2015 22:01:54 PAGE 1   


C51 COMPILER V9.02, COMPILATION OF MODULE SPI_ADCMCP3204
OBJECT MODULE PLACED IN spi_adcmcp3204.OBJ
COMPILER INVOKED BY: C:\Keil\C51\BIN\C51.EXE spi_adcmcp3204.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1          #include"P89V51Rx2.h"
   2          //#include"spi_adcmcp3204.h"
   3          
   4            sbit _cs=P1^4;
   5            sbit din=P1^5;
   6            sbit dout=P1^6;
   7            sbit clk=P1^7;
   8            unsigned char spi(unsigned char dat)
   9            {
  10   1                SPCFG=0X00;
  11   1                SPDAT=dat;
  12   1                while(!SPCFG) ;
  13   1              return SPDAT;
  14   1        }
  15          
  16           float read_adcmcp3204(unsigned char chNo)
  17            {
  18   1        unsigned char byte0,byte1,byte2,adc_val=0;
  19   1          _cs=0;
  20   1              SPCTL=0x53;
  21   1          byte0=spi(0x06);
  22   1              byte1=spi(chNo<<6);
  23   1              byte2=spi(0x00);
  24   1              _cs=1;
  25   1                      adc_val=((byte1&0x0f)<<8)|byte2;
  26   1                 return(adc_val*(5/4095));
  27   1        }     
  28           


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =     53    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----       1
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
